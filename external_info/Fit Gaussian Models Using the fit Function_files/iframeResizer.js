/*! iFrame Resizer (iframeSizer.min.js ) - v3.5.5 - 2016-06-16
 *  Desc: Force cross domain iframes to size to content.
 *  Requires: iframeResizer.contentWindow.min.js to be loaded into the target frame.
 *  Copyright: (c) 2016 David J. Bradshaw - dave@bradshaw.net
 *  License: MIT
 */
!function(z){"use strict";function E(e,n,t){"addEventListener"in z?e.addEventListener(n,t,!1):"attachEvent"in z&&e.attachEvent("on"+n,t)}function C(e,n,t){"removeEventListener"in z?e.removeEventListener(n,t,!1):"detachEvent"in z&&e.detachEvent("on"+n,t)}function e(){var e,n=["moz","webkit","o","ms"];for(e=0;e<n.length&&!h;e+=1)h=z[n[e]+"RequestAnimationFrame"];h||O("setup","RequestAnimationFrame not supported")}function n(e){var n="Host page: "+e;return z.top!==z.self&&(n=z.parentIFrame&&z.parentIFrame.getId?z.parentIFrame.getId()+": "+e:"Nested host page: "+e),n}function o(e){return D+"["+n(e)+"]"}function t(e){return X[e]?X[e].log:b}function O(e,n){i("log",e,n,t(e))}function R(e,n){i("info",e,n,t(e))}function T(e,n){i("warn",e,n,!0)}function i(e,n,t,i){!0===i&&"object"==typeof z.console&&console[e](o(n),t)}function r(n){function e(){function e(){L(F),H(M)}i("Height"),i("Width"),j(e,F,"init")}function t(){var e=I.substr(J).split(":");return{iframe:X[e[0]].iframe,id:e[0],height:e[1],width:e[2],type:e[3]}}function i(e){var n=Number(X[M]["max"+e]),t=Number(X[M]["min"+e]),i=e.toLowerCase(),o=Number(F[i]);O(M,"Checking "+i+" is in range "+t+"-"+n),o<t&&(o=t,O(M,"Set "+i+" to min value")),n<o&&(o=n,O(M,"Set "+i+" to max value")),F[i]=""+o}function o(){function e(){function e(){var e=0,n=!1;for(O(M,"Checking connection is from allowed list of origins: "+i);e<i.length;e++)if(i[e]===t){n=!0;break}return n}function n(){var e=X[M].remoteHost;return O(M,"Checking connection is from: "+e),t===e}return i.constructor===Array?e():n()}var t=n.origin,i=X[M].checkOrigin;if(i&&""+t!="null"&&!e())throw new Error("Unexpected message received from: "+t+" for "+F.iframe.id+". Message was: "+n.data+". This error can be disabled by setting the checkOrigin: false option or by providing of array of trusted domains.");return!0}function r(){return D===(""+I).substr(0,J)&&I.substr(J).split(":")[0]in X}function a(){var e=F.type in{"true":1,"false":1,undefined:1};return e&&O(M,"Ignoring init message from meta parent page"),e}function c(e){return I.substr(I.indexOf(":")+U+e)}function u(e){O(M,"MessageCallback passed: {iframe: "+F.iframe.id+", message: "+e+"}"),y("messageCallback",{iframe:F.iframe,message:JSON.parse(e)}),O(M,"--")}function f(){var e=document.body.getBoundingClientRect(),n=F.iframe.getBoundingClientRect();return JSON.stringify({iframeHeight:n.height,iframeWidth:n.width,clientHeight:Math.max(document.documentElement.clientHeight,z.innerHeight||0),clientWidth:Math.max(document.documentElement.clientWidth,z.innerWidth||0),offsetTop:parseInt(n.top-e.top,10),offsetLeft:parseInt(n.left-e.left,10),scrollTop:z.pageYOffset,scrollLeft:z.pageXOffset})}function s(e,n){function t(){q("Send Page Info","pageInfo:"+f(),e,n)}V(t,32)}function l(){function e(n,t){function i(){X[r]?s(X[r].iframe,r):o()}["scroll","resize"].forEach(function(e){O(r,n+e+" listener for sendPageInfo"),t(z,e,i)})}function o(){e("Remove ",C)}function n(){e("Add ",E)}var r=M;n(),X[r].stopPageInfo=o}function d(){X[M]&&X[M].stopPageInfo&&(X[M].stopPageInfo(),delete X[M].stopPageInfo)}function m(){var e=!0;return null===F.iframe&&(T(M,"IFrame ("+F.id+") not found"),e=!1),e}function g(e){var n=e.getBoundingClientRect();return S(M),{x:Math.floor(Number(n.left)+Number(Q.x)),y:Math.floor(Number(n.top)+Number(Q.y))}}function h(e){function n(){Q=r,p(),O(M,"--")}function t(){return{x:Number(F.width)+o.x,y:Number(F.height)+o.y}}function i(){z.parentIFrame?z.parentIFrame["scrollTo"+(e?"Offset":"")](r.x,r.y):T(M,"Unable to scroll to requested position, window.parentIFrame not found")}var o=e?g(F.iframe):{x:0,y:0},r=t();O(M,"Reposition requested from iFrame (offset x:"+o.x+" y:"+o.y+")"),z.top!==z.self?i():n()}function p(){!1!==y("scrollCallback",Q)?H(M):P()}function b(e){function n(){var e=g(r);O(M,"Moving to in page link (#"+i+") at x: "+e.x+" y: "+e.y),Q={x:e.x,y:e.y},p(),O(M,"--")}function t(){z.parentIFrame?z.parentIFrame.moveToAnchor(i):O(M,"In page link #"+i+" not found and window.parentIFrame not found")}var i=e.split("#")[1]||"",o=decodeURIComponent(i),r=document.getElementById(o)||document.getElementsByName(o)[0];r?n():z.top!==z.self?t():O(M,"In page link #"+i+" not found")}function y(e,n){return N(M,e,n)}function v(){switch(X[M].firstRun&&x(),F.type){case"close":W(F.iframe);break;case"message":u(c(6));break;case"scrollTo":h(!1);break;case"scrollToOffset":h(!0);break;case"pageInfo":s(X[M].iframe,M),l();break;case"pageInfoStop":d();break;case"inPageLink":b(c(9));break;case"reset":A(F);break;case"init":e(),y("initCallback",F.iframe),y("resizedCallback",F);break;default:e(),y("resizedCallback",F)}}function w(e){var n=!0;return X[e]||(n=!1,T(F.type+" No settings for "+e+". Message was: "+I)),n}function k(){for(var e in X)q("iFrame requested init",B(e),document.getElementById(e),e)}function x(){X[M].firstRun=!1}var I=n.data,F={},M=null;"[iFrameResizerChild]Ready"===I?k():r()?(F=t(),M=F.id,!a()&&w(M)&&(O(M,"Received: "+I),m()&&o()&&v())):R(M,"Ignored: "+I)}function N(e,n,t){var i=null,o=null;if(X[e]){if("function"!=typeof(i=X[e][n]))throw new TypeError(n+" on iFrame["+e+"] is not a function");o=i(t)}return o}function W(e){var n=e.id;O(n,"Removing iFrame: "+n),e.parentNode.removeChild(e),N(n,"closedCallback",n),O(n,"--"),delete X[n]}function S(e){null===Q&&O(e,"Get page position: "+(Q={x:void 0!==z.pageXOffset?z.pageXOffset:document.documentElement.scrollLeft,y:void 0!==z.pageYOffset?z.pageYOffset:document.documentElement.scrollTop}).x+","+Q.y)}function H(e){null!==Q&&(z.scrollTo(Q.x,Q.y),O(e,"Set page position: "+Q.x+","+Q.y),P())}function P(){Q=null}function A(e){function n(){L(e),q("reset","reset",e.iframe,e.id)}O(e.id,"Size reset requested by "+("init"===e.type?"host page":"iFrame")),S(e.id),j(n,e,"reset")}function L(n){function t(e){n.iframe.style[e]=n[e]+"px",O(n.id,"IFrame ("+o+") "+e+" set to "+n[e]+"px")}function i(e){g||"0"!==n[e]||(g=!0,O(o,"Hidden iFrame detected, creating visibility listener"),c())}function e(e){t(e),i(e)}var o=n.iframe.id;X[o]&&(X[o].sizeHeight&&e("height"),X[o].sizeWidth&&e("width"))}function j(e,n,t){t!==n.type&&h?(O(n.id,"Requesting animation frame"),h(e)):e()}function q(n,t,i,o){function e(){var e=X[o].targetOrigin;O(o,"["+n+"] Sending msg to iframe["+o+"] ("+t+") targetOrigin: "+e),i.contentWindow.postMessage(D+t,e)}function r(){R(o,"["+n+"] IFrame("+o+") not found"),X[o]&&delete X[o]}function a(){i&&"contentWindow"in i&&null!==i.contentWindow?e():r()}o=o||i.id,X[o]&&a()}function B(e){return e+":"+X[e].bodyMarginV1+":"+X[e].sizeWidth+":"+X[e].log+":"+X[e].interval+":"+X[e].enablePublicMethods+":"+X[e].autoResize+":"+X[e].bodyMargin+":"+X[e].heightCalculationMethod+":"+X[e].bodyBackground+":"+X[e].bodyPadding+":"+X[e].tolerance+":"+X[e].inPageLinks+":"+X[e].resizeFrom+":"+X[e].widthCalculationMethod}function a(t,n){function e(){function e(e){1/0!==X[h][e]&&0!==X[h][e]&&(t.style[e]=X[h][e]+"px",O(h,"Set "+e+" = "+X[h][e]+"px"))}function n(e){if(X[h]["min"+e]>X[h]["max"+e])throw new Error("Value for min"+e+" can not be greater than max"+e)}n("Height"),n("Width"),e("maxHeight"),e("minHeight"),e("maxWidth"),e("minWidth")}function i(){var e=n&&n.id||w.id+p++;return null!==document.getElementById(e)&&(e+=p++),e}function o(e){return""===e&&(t.id=e=i(),b=(n||{}).log,O(e,"Added missing iframe ID: "+e+" ("+t.src+")")),e}function r(){O(h,"IFrame scrolling "+(X[h].scrolling?"enabled":"disabled")+" for "+h),t.style.overflow=!1===X[h].scrolling?"hidden":"auto",t.scrolling=!1===X[h].scrolling?"no":"yes"}function a(){("number"==typeof X[h].bodyMargin||"0"===X[h].bodyMargin)&&(X[h].bodyMarginV1=X[h].bodyMargin,X[h].bodyMargin=X[h].bodyMargin+"px")}function c(){var e=X[h].firstRun,n=X[h].heightCalculationMethod in y;!e&&n&&A({iframe:t,height:0,width:0,type:"init"})}function u(){Function.prototype.bind&&(X[h].iframe.iFrameResizer={close:W.bind(null,X[h].iframe),resize:q.bind(null,"Window resize","resize",X[h].iframe),moveToAnchor:function(e){q("Move to anchor","moveToAnchor:"+e,X[h].iframe,h)},sendMessage:function(e){q("Send Message","message:"+(e=JSON.stringify(e)),X[h].iframe,h)}})}function f(e){function n(){q("iFrame.onload",e,t),c()}E(t,"load",n),q("init",e,t)}function s(e){if("object"!=typeof e)throw new TypeError("Options is not an object")}function l(e){for(var n in w)w.hasOwnProperty(n)&&(X[h][n]=e.hasOwnProperty(n)?e[n]:w[n])}function d(e){return""===e||"file://"===e?"*":e}function m(e){e=e||{},X[h]={firstRun:!0,iframe:t,remoteHost:t.src.split("/").slice(0,3).join("/")},s(e),l(e),X[h].targetOrigin=!0===X[h].checkOrigin?d(X[h].remoteHost):"*"}function g(){return h in X&&"iFrameResizer"in t}var h=o(t.id);g()?T(h,"Ignored iFrame, already setup."):(m(n),r(),e(),a(),f(B(h)),u())}function V(e,n){null===v&&(v=setTimeout(function(){v=null,e()},n))}function c(){function n(){function e(n){function e(e){return"0px"===X[n].iframe.style[e]}function t(e){return null!==e.offsetParent}t(X[n].iframe)&&(e("height")||e("width"))&&q("Visibility change","resize",X[n].iframe,n)}for(var n in X)e(n)}function t(e){O("window","Mutation observed: "+e[0].target+" "+e[0].type),V(n,16)}function e(){var e=document.querySelector("body"),n={attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0};new i(t).observe(e,n)}var i=z.MutationObserver||z.WebKitMutationObserver;i&&e()}function u(e){function n(){s("Window "+e,"resize")}O("window","Trigger event: "+e),V(n,16)}function f(){function e(){s("Tab Visable","resize")}"hidden"!==document.visibilityState&&(O("document","Trigger event: Visiblity change"),V(e,16))}function s(e,n){function t(e){return"parent"===X[e].resizeFrom&&X[e].autoResize&&!X[e].firstRun}for(var i in X)t(i)&&q(e,n,document.getElementById(i),i)}function l(){E(z,"message",r),E(z,"resize",function(){u("resize")}),E(document,"visibilitychange",f),E(document,"-webkit-visibilitychange",f),E(z,"focusin",function(){u("focus")}),E(z,"focus",function(){u("focus")})}function d(){function t(e,n){function t(){if(!n.tagName)throw new TypeError("Object is not a valid DOM element");if("IFRAME"!==n.tagName.toUpperCase())throw new TypeError("Expected <IFRAME> tag, found <"+n.tagName+">")}n&&(t(),a(n,e),i.push(n))}var i;return e(),l(),function(e,n){switch(i=[],typeof n){case"undefined":case"string":Array.prototype.forEach.call(document.querySelectorAll(n||"iframe"),t.bind(void 0,e));break;case"object":t(e,n);break;default:throw new TypeError("Unexpected data type ("+typeof n+")")}return i}}function m(e){e.fn?e.fn.iFrameResize=function(t){function e(e,n){a(n,t)}return this.filter("iframe").each(e).end()}:R("","Unable to bind to jQuery, it is not fully loaded.")}var p=0,b=!1,g=!1,U="message".length,D="[iFrameSizer]",J=D.length,Q=null,h=z.requestAnimationFrame,y={max:1,scroll:1,bodyScroll:1,documentElementScroll:1},X={},v=null,w={autoResize:!0,bodyBackground:null,bodyMargin:null,bodyMarginV1:8,bodyPadding:null,checkOrigin:!0,inPageLinks:!1,enablePublicMethods:!0,heightCalculationMethod:"bodyOffset",id:"iFrameResizer",interval:32,log:!1,maxHeight:1/0,maxWidth:1/0,minHeight:0,minWidth:0,resizeFrom:"parent",scrolling:!1,sizeHeight:!0,sizeWidth:!1,tolerance:0,widthCalculationMethod:"scroll",closedCallback:function(){},initCallback:function(){},messageCallback:function(){T("MessageCallback function not defined")},resizedCallback:function(){},scrollCallback:function(){return!0}};z.jQuery&&m(jQuery),"function"==typeof define&&define.amd?define([],d):"object"==typeof module&&"object"==typeof module.exports?module.exports=d():z.iFrameResize=z.iFrameResize||d()}(window||{});